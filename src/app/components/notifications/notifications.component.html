<div class="notifications-container">
  <div class="notifications-header">
    <h2>Notifications</h2>
    <div class="header-actions">
      <button mat-icon-button (click)="refreshNotifications()" matTooltip="Actualiser">
        <mat-icon>refresh</mat-icon>
      </button>
      <button mat-icon-button (click)="toggleUnreadOnly()" matTooltip="Afficher uniquement les non lues">
        <mat-icon>{{ showUnreadOnly ? 'visibility' : 'visibility_off' }}</mat-icon>
      </button>
      <button mat-raised-button color="primary" (click)="markAllAsRead()" *ngIf="getUnreadCount() > 0">
        <mat-icon>done_all</mat-icon>
        Tout marquer comme lu
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des notifications...</p>
  </div>

  <!-- Notifications List -->
  <div class="notifications-content" *ngIf="!loading">
    <!-- Unread Count Badge -->
    <div class="unread-badge" *ngIf="getUnreadCount() > 0">
      <mat-icon>notifications</mat-icon>
      <span>{{ getUnreadCount() }} notification(s) non lue(s)</span>
    </div>

    <!-- Notifications -->
    <div class="notifications-list" *ngIf="getDisplayedNotifications().length > 0; else emptyState">
      <div class="notification-item" 
           *ngFor="let notification of getDisplayedNotifications()"
           [class.unread]="!notification.isRead"
           [class.read]="notification.isRead">
        
        <div class="notification-icon" [style.color]="getNotificationColor(notification)">
          <mat-icon>{{ getNotificationIcon(notification) }}</mat-icon>
        </div>

        <div class="notification-content">
          <div class="notification-header">
            <h4 class="notification-subject">{{ notification.subject }}</h4>
            <div class="notification-actions">
              <button mat-icon-button 
                      (click)="markAsRead(notification)" 
                      *ngIf="!notification.isRead"
                      matTooltip="Marquer comme lu">
                <mat-icon>check</mat-icon>
              </button>
              <button mat-icon-button 
                      (click)="deleteNotification(notification)"
                      matTooltip="Supprimer">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>

          <div class="notification-body">
            <p class="notification-text">{{ notification.content }}</p>
            <div class="notification-meta">
              <span class="notification-time">{{ formatTime(notification.sentAt) }}</span>
              <span class="notification-email">{{ notification.recipientEmail }}</span>
              <button mat-button 
                      color="primary" 
                      *ngIf="notification.relatedIncidentId"
                      (click)="openIncident(notification.relatedIncidentId!)">
                Voir l'incident #{{ notification.relatedIncidentId }}
              </button>
            </div>
          </div>
        </div>

        <div class="notification-status" *ngIf="!notification.isRead">
          <div class="unread-indicator"></div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <ng-template #emptyState>
      <div class="empty-state">
        <mat-icon>notifications_off</mat-icon>
        <h3>Aucune notification</h3>
        <p *ngIf="showUnreadOnly">Toutes vos notifications ont été lues</p>
        <p *ngIf="!showUnreadOnly">Vous n'avez pas encore reçu de notifications</p>
      </div>
    </ng-template>
  </div>

  <!-- Notification Settings -->
  <div class="notification-settings" *ngIf="!loading">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>settings</mat-icon>
          Paramètres des notifications
        </mat-panel-title>
      </mat-expansion-panel-header>
      
      <div class="settings-content">
        <mat-form-field appearance="outline">
          <mat-label>Email de notification</mat-label>
          <input matInput [value]="authService.currentUserValue?.email || ''" readonly>
          <mat-icon matSuffix>email</mat-icon>
        </mat-form-field>

        <div class="settings-options">
          <mat-slide-toggle checked>Notifications par email</mat-slide-toggle>
          <mat-slide-toggle checked>Notifications d'incidents</mat-slide-toggle>
          <mat-slide-toggle checked>Notifications de SLA</mat-slide-toggle>
          <mat-slide-toggle checked>Notifications de commentaires</mat-slide-toggle>
          <mat-slide-toggle>Notifications système</mat-slide-toggle>
        </div>
      </div>
    </mat-expansion-panel>
  </div>
</div>
