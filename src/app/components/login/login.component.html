<div class="login-wrapper">
  <section class="hero">
    <img src="assets/images/sgi-logo.png" alt="SGI Logo" class="hero-logo" />
    <h1>Bienvenue</h1>
    <p class="tagline">Connectez-vous pour accéder à votre espace</p>
  </section>

  <section class="form-panel mat-elevation-z8">
    <ng-container *ngIf="!showRegister; else registerTpl">
    <header class="panel-header">
      <h2>
        <mat-icon>lock</mat-icon>
        Se connecter
      </h2>
      <p class="register">Ou <a (click)="openRegister()" role="button" tabindex="0">Créer un nouveau compte</a></p>
    </header>

    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nom d'utilisateur</mat-label>
        <input matInput formControlName="username" type="text" placeholder="Nom d'utilisateur" />
        <mat-icon matSuffix>person</mat-icon>
        <mat-error *ngIf="loginForm.get('username')?.invalid">
          {{ getErrorMessage('username') }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Mot de passe</mat-label>
        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" />
        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button" aria-label="Afficher/Masquer le mot de passe">
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="loginForm.get('password')?.invalid">
          {{ getErrorMessage('password') }}
        </mat-error>
      </mat-form-field>

      <div class="form-extras">
        <mat-checkbox formControlName="rememberMe">Se souvenir de moi</mat-checkbox>
        <a routerLink="/forgot-password" class="link">Mot de passe oublié ?</a>
      </div>

      <button mat-flat-button color="primary" type="submit" class="submit-btn" [disabled]="loginForm.invalid || loading">
        <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
        <span *ngIf="!loading">Se Connecter</span>
      </button>
    </form>

    </ng-container>

    <ng-template #registerTpl>
      <header class="panel-header">
        <h2>
          <mat-icon>person_add</mat-icon>
          Créer un compte
        </h2>
        <p class="register">Déjà inscrit ? <a (click)="backToLogin()" role="button" tabindex="0">Se connecter</a></p>
      </header>
      <app-register (back)="backToLogin()" [embedded]="true"></app-register>
    </ng-template>
  </section>
</div>
